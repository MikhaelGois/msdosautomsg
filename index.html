
<!DOCTYPE html>
<html lang="en" class="app-root">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>Luxottica IT Utilitary</title>
  <link rel="stylesheet" href="dist/styles.css?v=8" />
  <!-- Removed login redirect: app is now accessible without auth -->
</head>
<body>
  <header class="header">
    <div class="header-row">
      <div>
        <h1>Luxottica IT Utilitary</h1>
        <div class="prompt">Automatic message, password and e-mail generator</div>
      </div>
      <div class="header-controls">
        <div class="theme-toggle">
          <input id="themeToggle" type="checkbox" aria-label="Toggle dark mode" />
          <label for="themeToggle" class="theme-label" title="Alternar tema">
            <span class="icon icon-sun" aria-hidden="true"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="4" fill="#FFD166"/><g stroke="#FFD166" stroke-width="1.2" stroke-linecap="round"><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M4.93 19.07l1.41-1.41"/><path d="M17.66 6.34l1.41-1.41"/></g></svg></span>
            <span class="icon icon-moon" aria-hidden="true"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" fill="#9AD0F7"/></svg></span>
            <span class="toggle-knob" aria-hidden="true"></span>
          </label>
        </div>
      </div>
    </div>
  </header>

  <!-- Horizontal tab navigation -->
  <nav class="tabbar-container">
    <div class="tabbar" role="tablist" aria-label="Main tools">
      <button id="tab-messages" class="btn ghost" data-tab="messages" role="tab" aria-controls="messageCard">üìù Mensagens</button>
      <button id="tab-emails" class="btn ghost" data-tab="emails" role="tab" aria-controls="emailCard">üìß Gerador de E-mails</button>
      <button id="tab-passwords" class="btn ghost" data-tab="passwords" role="tab" aria-controls="passwordCard">üîê Gerador de Senhas</button>
    </div>
    <div class="tab-analyst">Signed in as: <span class="analyst-name">Mikhael</span></div>
  </nav>

  <main class="container">
      <!-- ====== Mensagens de Ticket ====== -->
      <section class="card" id="messageCard" data-tab="messages">
        <h2>Mensagens de Ticket</h2>

        <form id="messageForm" class="form-grid" autocomplete="off">
          <div class="form-row">
            <label for="channelSelect">Canal</label>
            <select id="channelSelect">
              <option value="teams">Microsoft Teams</option>
              <option value="requestia">Requestia (encerramento)</option>
            </select>
          </div>

          <div class="form-row">
            <label for="messageType">Tipo de mensagem</label>
            <select id="messageType">
              <option value="progress">Atendimento / Em andamento</option>
              <option value="closure">Encerramento</option>
            </select>
          </div>

          <div class="form-row">
            <label for="categorySelect">Categoria</label>
            <select id="categorySelect"></select>
          </div>

          <div class="form-row" id="subcategoryRow">
            <label for="subcategorySelect">Subcategoria</label>
            <select id="subcategorySelect"></select>
          </div>

          <div class="form-row">
            <label for="ticketId">Ticket</label>
            <input id="ticketId" type="text" placeholder="#12345" />
          </div>

          <div class="form-row">
            <label for="requesterName">Nome do usu√°rio</label>
            <input id="requesterName" type="text" placeholder="Nome do usu√°rio" />
          </div>

          <div class="form-row">
            <label for="username">Usu√°rio (login)</label>
            <input id="username" type="text" placeholder="ex.: jdoe" />
          </div>

          <div class="btn-row span-2">
            <button type="button" id="generateMsgPTBtn" class="btn">Gerar Mensagem</button>
            <button type="button" id="copyMsgBtn" class="btn">Copiar</button>
            <button type="reset" id="clearMsgBtn" class="btn ghost">Limpar</button>
          </div>

          <div class="form-row span-2">
            <label for="output">Mensagem gerada</label>
            <textarea id="output" rows="6" readonly></textarea>
          </div>
        </form>
      </section>

      <!-- ====== Gerador de E-mails (templates) ====== -->
      <section class="card" id="emailCard" data-tab="emails">
        <h2>Gerador de E-mails (templates)</h2>
        <div class="form-grid">
          <div class="form-row span-2">
            <label for="templateSelect">Modelo</label>
            <select id="templateSelect"></select>
          </div>
          <div class="form-row">
            <label for="languageSelect">Idioma</label>
            <select id="languageSelect">
              <option value="pt">Portugu√™s (PT)</option>
              <option value="en">English (EN)</option>
            </select>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-row span-2">
            <label for="emailSubject">Assunto</label>
            <textarea id="emailSubject" rows="1" placeholder="Assunto do e-mail" class="auto-resize"></textarea>
          </div>
        </div>

        <div id="newRequirementsRow" class="form-grid">
          <div class="form-row span-2">
            <label for="newRequirements">Descreva o que precisa (novo modelo)</label>
            <textarea id="newRequirements" rows="2" placeholder="Descreva o objetivo, tom e p√∫blico do e-mail" class="auto-resize"></textarea>
          </div>
        </div>

        <div id="templateFieldsContainer" class="form-grid" style="display: block;">
          <div id="templateFields" class="span-2"></div>
        </div>

        <div class="form-grid">
          <div class="btn-row span-2">
            <button type="button" id="generateEmailBtn" class="btn">Gerar E-mail</button>
            <button type="button" id="copyEmailBtn" class="btn ghost">Copiar</button>
            <button type="button" id="clearEmailBtn" class="btn ghost">Limpar</button>
            <button type="button" id="saveTemplateBtn" class="btn ghost">Salvar modelo</button>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-row span-2">
            <label for="emailBodyOutput">Corpo do e-mail gerado</label>
            <textarea id="emailBodyOutput" rows="8" class="auto-resize"></textarea>
          </div>
        </div>
      </section>

      <!-- ====== Gerador de Senhas ====== -->
      <section class="card" id="passwordCard" data-tab="passwords">
        <h2>Gerador de Senhas (pol√≠tica)</h2>

        <form id="passwordForm" class="form-grid" autocomplete="off">
          <div class="form-row">
            <label for="pwName">Nome do usu√°rio</label>
            <input id="pwName" type="text" placeholder="Nome completo" />
          </div>

          <div class="form-row">
            <label for="pwUsername">Login</label>
            <input id="pwUsername" type="text" placeholder="login/usu√°rio" />
          </div>

          <div class="form-row">
            <label for="pwLength">Comprimento</label>
            <input id="pwLength" type="number" min="12" value="12" />
          </div>

          <div class="form-row">
            <label class="checkbox">
              <input type="checkbox" id="pwSymbols" checked />
              <span>Incluir s√≠mbolos (!@#$%)</span>
            </label>
          </div>

          <div class="btn-row">
            <button type="button" id="generatePwBtn" class="btn">Gerar senha</button>
            <button type="button" id="copyPwBtn" class="btn">Copiar</button>
            <button type="reset" id="clearPwBtn" class="btn ghost">Limpar</button>
          </div>

          <div class="form-row span-2">
            <label for="pwOutput">Senha gerada</label>
            <input id="pwOutput" type="text" readonly />
          </div>

          <div class="span-2">
            <p><strong>Pol√≠tica:</strong></p>
            <ul>
              <li>Diferencia mai√∫sculas de min√∫sculas</li>
              <li>M√≠nimo de 12 caracteres</li>
              <li>Inclui ao menos 1 n√∫mero</li>
              <li>Inclui ao menos 1 letra min√∫scula</li>
              <li>Inclui ao menos 1 letra mai√∫scula</li>
              <li>N√£o cont√©m parte do nome/login</li>
              <li>N√£o cont√©m palavra/seq. comum</li>
            </ul>
          </div>
        </form>
      </section>
  </main>

  <footer class="footer">
    <small>&copy; 2026 ‚Äî Luxottica IT Utilitary.</small>
  </footer>

  
  <script src="dist/app.js?v=8"></script>
  <script>
    // ===== Email Generator (inline) =====
    const templates = [
      {id:"extend-expired",name:"Request to Extend Expired Account Access (Solicita√ß√£o de Extens√£o de Acesso de Conta Expirada)",subject:"Request to Extend Expired Account Access",body:`Dear Team,\nPlease extend the account access for the user below. The account has already expired:\n‚Ä¢ Email Address: mutavel\n‚Ä¢ Employee ID or External Reference: mutavel\n‚Ä¢ Expiration Date: mutavel\n‚Ä¢ Ticket BR: mutavel\nLet me know if you need any additional details to process this request.\nThank you for your assistance.`,fieldLabels:["Email Address","Employee ID or External Reference","Expiration Date","Ticket BR"]},
      {id:"mfa-reset",name:"Request for MFA Reset (Solicita√ß√£o de Reset de MFA)",subject:"Request for MFA Reset",body:`Dear Team,\nPlease reset the Multi-Factor Authentication (MFA) for the following user:\nName: mutavel\nUsername: mutavel\nEmail: mutavel\nThe user is unable to complete the login process due to MFA issues. Let me know if you need any additional details to process this request.\nThank you for your assistance.`,fieldLabels:["Name","Username","Email"]},
      {id:"third-party-lux-create",name:"Request for Third-Party Luxottica Account (Solicita√ß√£o de Conta Luxottica de Terceiros)",subject:"Request for Third-Party Luxottica Account",body:`Dear Team,\nPlease create a new Luxottica account for the third-party user below:\n‚Ä¢ Full Name: mutavel\n‚Ä¢ SMTP: mutavel\n‚Ä¢ Mail Group: mutavel\n‚Ä¢ Logon Script: mutavel\n‚Ä¢ License: mutavel\n‚Ä¢ External Reference or Employee ID: mutavel\n‚Ä¢ Copy Settings From: mutavel\n‚Ä¢ Ticket BR: mutavel\nLet me know if you need any additional details to process this request.\nThank you for your assistance.`,fieldLabels:["Full Name","SMTP","Mail Group","Logon Script","License","External Reference or Employee ID","Copy Settings From","Ticket BR"]},
      {id:"new-lux-create",name:"Request for New Luxottica Account (Solicita√ß√£o de Nova Conta Luxottica)",subject:"Request for New Luxottica Account",body:`Dear Team,\nPlease create a new Luxottica account for the user below:\n‚Ä¢ Full Name: mutavel\n‚Ä¢ SMTP: mutavel\n‚Ä¢ Mail Group: mutavel\n‚Ä¢ Logon Script: mutavel\n‚Ä¢ License: mutavel\n‚Ä¢ Employee ID: mutavel\n‚Ä¢ Copy Settings From: mutavel\n‚Ä¢ Ticket BR: mutavel\nLet me know if you need any additional details to process this request.\nThank you for your assistance.`,fieldLabels:["Full Name","SMTP","Mail Group","Logon Script","License","Employee ID","Copy Settings From","Ticket BR"]},
      {id:"add-to-dl",name:"Request to Add Email to Distribution Group(s) (Solicita√ß√£o para Adicionar E-mail ao(s) Grupo(s) de Distribui√ß√£o)",subject:"Request to Add Email to Distribution Group(s)",body:`Dear Team,\nPlease add the email address below to the specified group(s):\n‚Ä¢ Email Address: mutavel\n‚Ä¢ Group(s): mutavel\n‚Ä¢ Ticket BR: mutavel\nLet me know if you need any additional details to process this request.\nThank you for your assistance.`,fieldLabels:["Email Address","Group(s)","Ticket BR"]},
      {id:"remove-from-dl",name:"Request to Remove Email from Distribution Group(s) (Solicita√ß√£o para Remover E-mail do(s) Grupo(s) de Distribui√ß√£o)",subject:"Request to Remove Email from Distribution Group(s)",body:`Dear Team,\nPlease remove the email address below from the specified group(s):\n‚Ä¢ Email Address: mutavel\n‚Ä¢ Group(s): mutavel\n‚Ä¢ Ticket BR: mutavel\nLet me know if you need any additional details to process this request.\nThank you for your assistance.`,fieldLabels:["Email Address","Group(s)","Ticket BR"]},
      {id:"delete-email",name:"Request to Delete Email Account (Solicita√ß√£o de Exclus√£o de Conta de E-mail)",subject:"Request to Delete Email Account",body:`Dear Team,\nPlease delete the email account below:\n‚Ä¢ Email Address: mutavel\n‚Ä¢ Employee ID or External Reference: mutavel\n‚Ä¢ Ticket BR: mutavel\nLet me know if you need any additional details to process this request.\nThank you for your assistance.`,fieldLabels:["Email Address","Employee ID or External Reference","Ticket BR"]},
      {id:"modify-lux",name:"Request to Modify Existing Luxottica Account (Solicita√ß√£o de Modifica√ß√£o de Conta Luxottica Existente)",subject:"Request to Modify Existing Luxottica Account",body:`Dear Team,\nPlease update the Luxottica account with the details below:\n‚Ä¢ Email Address: mutavel\n‚Ä¢ Changes Required: mutavel\n‚Ä¢ Employee ID or External Reference: mutavel\n‚Ä¢ Ticket BR: mutavel\nLet me know if you need any additional details to process this request.\nThank you for your assistance.`,fieldLabels:["Email Address","Changes Required","Employee ID or External Reference","Ticket BR"]},
      {id:"mirror-lux",name:"Request to Modify Account by Mirroring Existing User (Solicita√ß√£o de Modifica√ß√£o de Conta Espelhando Usu√°rio Existente)",subject:"Request to Modify Account by Mirroring Existing User",body:`Dear Team,\nPlease update the Luxottica account below to mirror the settings of another user:\n‚Ä¢ Email Address to Modify: mutavel\n‚Ä¢ Mirror Settings From: mutavel\n‚Ä¢ Employee ID or External Reference: mutavel\n‚Ä¢ Ticket BR: mutavel\nLet me know if you need any additional details to process this request.\nThank you for your assistance.`,fieldLabels:["Email Address to Modify","Mirror Settings From","Employee ID or External Reference","Ticket BR"]},
      {id:"reactivate-email",name:"Request to Reactivate Email Account (Solicita√ß√£o de Reativa√ß√£o de Conta de E-mail)",subject:"Request to Reactivate Email Account",body:`Dear Team,\nPlease reactivate the email account below:\n‚Ä¢ Email Address: mutavel\n‚Ä¢ Employee ID or External Reference: mutavel\n‚Ä¢ Reason for Reactivation: mutavel\n‚Ä¢ Ticket BR: mutavel\nLet me know if you need any additional details to process this request.\nThank you for your assistance.`,fieldLabels:["Email Address","Employee ID or External Reference","Reason for Reactivation","Ticket BR"]},
      {id:"3rd-party-not-receiving",name:"User Not Receiving Third-Party Emails (Usu√°rio N√£o Recebendo E-mails de Terceiros)",subject:"User Not Receiving Third-Party Emails",body:`Dear Team,\nPlease check and resolve the issue below:\n‚Ä¢ Email Address: mutavel\n‚Ä¢ Description of Issue: mutavel\n‚Ä¢ Steps Already Taken: mutavel\n‚Ä¢ Ticket BR: mutavel\nLet me know if you need any additional details to process this request.\nThank you for your assistance.`,fieldLabels:["Email Address","Description of Issue","Steps Already Taken","Ticket BR"]},
      {id:"upgrade-license",name:"Request to Upgrade Office License from E1 to E3 (Solicita√ß√£o de Upgrade de Licen√ßa Office de E1 para E3)",subject:"Request to Upgrade Office License from E1 to E3",body:`Dear Team,\nPlease upgrade the Office license for the user below:\n‚Ä¢ Email Address: mutavel\n‚Ä¢ Current License: mutavel\n‚Ä¢ New License: mutavel\n‚Ä¢ Employee ID or External Reference: mutavel\n‚Ä¢ Ticket BR: mutavel\nLet me know if you need any additional details to process this request.\nThank you for your assistance.`,fieldLabels:["Email Address","Current License","New License","Employee ID or External Reference","Ticket BR"]},
      {id:"renew-e3",name:"Request to Renew Expired Office License (E3) (Solicita√ß√£o de Renova√ß√£o de Licen√ßa Office Expirada (E3))",subject:"Request to Renew Expired Office License (E3)",body:`Dear Team,\nThe Office license for the user below has expired. Please proceed with the renewal or reactivation:\n‚Ä¢ Email Address: mutavel\n‚Ä¢ Previous License: mutavel\n‚Ä¢ Status: Expired\n‚Ä¢ Employee ID or External Reference: mutavel\n‚Ä¢ Ticket BR: mutavel\nLet me know if you need any additional details to process this request.\nThank you for your assistance.`,fieldLabels:["Email Address","Previous License","Employee ID or External Reference","Ticket BR"]},
      {id:"unlock-account",name:"Request to Unlock User Account (Solicita√ß√£o de Desbloqueio de Conta de Usu√°rio)",subject:"Request to Unlock User Account",body:`Dear Team,\nPlease unlock the account for the user below:\n‚Ä¢ Email Address: mutavel\n‚Ä¢ Employee ID or External Reference: mutavel\n‚Ä¢ Domain Group: mutavel\n‚Ä¢ Reason for Unlock: mutavel\n‚Ä¢ Ticket BR: mutavel\nLet me know if you need any additional details to process this request.\nThank you for your assistance.`,fieldLabels:["Email Address","Employee ID or External Reference","Domain Group","Reason for Unlock","Ticket BR"]},
      {id:"block-deactivate",name:"Request to Block and Deactivate User Access (Solicita√ß√£o de Bloqueio e Desativa√ß√£o de Acesso de Usu√°rio)",subject:"Request to Block and Deactivate User Access",body:`Dear Team,\nPlease proceed with blocking and deactivating all access for the user below:\n‚Ä¢ Email Address: mutavel\n‚Ä¢ Employee ID or External Reference: mutavel\n‚Ä¢ Domain Group(s): mutavel\n‚Ä¢ Reason: mutavel\n‚Ä¢ Ticket BR: mutavel\nEnsure that all related accounts, permissions, and access to corporate resources are disabled.\nLet me know if you need any additional details to complete this request.\nThank you for your assistance.`,fieldLabels:["Email Address","Employee ID or External Reference","Domain Group(s)","Reason","Ticket BR"]}
    ];
    let state={currentTemplate:null,values:[]};
    const $=(sel)=>document.querySelector(sel);
    function getTemplateById(id){return templates.find(t=>t.id===id);}
    function countPlaceholders(subject,body){const rx=/mutavel/g;const inSubj=(subject.match(rx)||[]).length;const inBody=(body.match(rx)||[]).length;return[inSubj,inBody,inSubj+inBody];}
    function replaceNth(text,token,replacements){let i=0;return text.replace(new RegExp(token,"g"),()=>(replacements[i++]??token));}
    function loadTemplates(){const el=$("#templateSelect");if(!el)return;el.innerHTML="";templates.forEach(t=>{const opt=document.createElement("option");opt.value=t.id;opt.textContent=t.name;el.appendChild(opt);});setTemplate(templates[0].id);}
    function renderFields(){const el=$("#templateFields");const container=$("#templateFieldsContainer");if(!el||!container)return;const t=state.currentTemplate;const[subjCount,bodyCount,total]=countPlaceholders(t.subject,t.body);if(!Array.isArray(state.values)||state.values.length!==total)state.values=Array(total).fill("");el.innerHTML="";container.style.display="block";const labels=t.fieldLabels&&t.fieldLabels.length===total?t.fieldLabels:Array.from({length:total},(_,i)=>`Campo ${i+1}`);labels.forEach((label,idx)=>{const wrap=document.createElement("div");wrap.className="form-row";const lab=document.createElement("label");lab.textContent=label;lab.setAttribute("for",`f_${idx}`);const inp=document.createElement("input");inp.id=`f_${idx}`;inp.placeholder=label;inp.value=state.values[idx]||"";inp.addEventListener("input",e=>{state.values[idx]=e.target.value;updatePreview();});wrap.appendChild(lab);wrap.appendChild(inp);el.appendChild(wrap);});updatePreview();console.log(`Rendered ${labels.length} fields for template: ${t.name}`);}
    function updatePreview(){const elSubj=$("#emailSubject");const elBody=$("#emailBodyOutput");if(!elSubj||!elBody)return;const t=state.currentTemplate;const[subjCount,bodyCount]=countPlaceholders(t.subject,t.body);const subjVals=state.values.slice(0,subjCount);const bodyVals=state.values.slice(subjCount,subjCount+bodyCount);const finalSubj=replaceNth(t.subject,"mutavel",subjVals);const finalBody=replaceNth(t.body,"mutavel",bodyVals);elSubj.value=finalSubj;elBody.value=finalBody;console.log(`Updated preview: ${finalBody.substring(0,50)}...`);}
    function setTemplate(id){const t=getTemplateById(id);state.currentTemplate=structuredClone(t);const[,,total]=countPlaceholders(t.subject,t.body);state.values=Array(total).fill("");renderFields();}
    document.addEventListener("DOMContentLoaded",()=>{const elTpl=$("#templateSelect");const btnCopy=$("#copyEmailBtn");const btnReset=$("#clearEmailBtn");loadTemplates();elTpl?.addEventListener("change",(e)=>{setTemplate(e.target.value);});btnCopy?.addEventListener("click",async()=>{const subj=$("#emailSubject")?.value?.trim();const body=$("#emailBodyOutput")?.value?.trim();if(!subj)return alert("Preencha o assunto primeiro");if(!body)return alert("Preencha os campos primeiro");const content=`Subject: ${subj}\n\n${body}`;try{await navigator.clipboard.writeText(content);const old=btnCopy.textContent;btnCopy.textContent="Copiado ‚úî";setTimeout(()=>btnCopy.textContent=old,1200);}catch(e){alert("Copie manualmente:\n\n"+content);}});btnReset?.addEventListener("click",(e)=>{e.preventDefault();state.values=state.values.map(()=>"");$("#templateFields")?.querySelectorAll("input").forEach((inp)=>inp.value="");const elSubj=$("#emailSubject");const elBody=$("#emailBodyOutput");if(elSubj)elSubj.value="";if(elBody)elBody.value="";updatePreview();});});
    document.addEventListener("DOMContentLoaded",()=>{const elTpl=$("#templateSelect");const btnCopy=$("#copyEmailBtn");const btnReset=$("#clearEmailBtn");const btnSave=$("#saveTemplateBtn");loadTemplates();elTpl?.addEventListener("change",(e)=>{setTemplate(e.target.value);});btnCopy?.addEventListener("click",async()=>{const subj=$("#emailSubject")?.value?.trim();const body=$("#emailBodyOutput")?.value?.trim();if(!subj)return alert("Preencha o assunto primeiro");if(!body)return alert("Preencha os campos primeiro");const content=`Subject: ${subj}\n\n${body}`;try{await navigator.clipboard.writeText(content);const old=btnCopy.textContent;btnCopy.textContent="Copiado ‚úî";setTimeout(()=>btnCopy.textContent=old,1200);}catch(e){alert("Copie manualmente:\n\n"+content);}});btnReset?.addEventListener("click",(e)=>{e.preventDefault();state.values=state.values.map(()=>"");$("#templateFields")?.querySelectorAll("input").forEach((inp)=>inp.value="");const elSubj=$("#emailSubject");const elBody=$("#emailBodyOutput");if(elSubj)elSubj.value="";if(elBody)elBody.value="";updatePreview();});

      // Save current generated email as template on server
      btnSave?.addEventListener('click', async ()=>{
        try{
          const subj = (document.querySelector('#emailSubject')?.value || '').trim();
          const body = (document.querySelector('#emailBodyOutput')?.value || '').trim();
          if(!subj && !body) return alert('Nada para salvar ‚Äî gere o e-mail antes.');
          const defaultName = state.currentTemplate?.name || 'Modelo Personalizado';
          const name = prompt('Nome do modelo a salvar:', defaultName + ' - ' + new Date().toISOString().slice(0,19).replace('T',' '));
          if(!name) return;
          const payload = { name: name, text: 'Subject: ' + subj + '\n\n' + body };
          const res = await fetch('/api/save-template', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload) });
          const j = await res.json().catch(()=>({}));
          if(!res.ok) return alert('Erro ao salvar: ' + (j.error || res.statusText));
          alert('Modelo salvo com sucesso. ID: ' + (j.id || 'desconhecido'));
        }catch(err){ alert('Erro ao salvar: ' + err.message); }
      });
    });
  </script>
  <script>
    (function(){
      if(typeof EventSource === 'undefined') return;
      try{
        const es = new EventSource('/_sse');
        es.onopen = ()=>{ console.log('SSE: connected'); };
        es.onmessage = (e)=>{ /* optional: handle server messages */ };
        es.onerror = ()=>{ console.log('SSE: error/closed'); };
        window.addEventListener('beforeunload', ()=>{ try{ es.close(); }catch(e){} });
      }catch(e){ console.warn('SSE init failed', e); }
    })();
  </script>
</body>
</html>
